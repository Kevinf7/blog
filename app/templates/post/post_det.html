{% extends "base.html" %}
{% block nav_home %}active{% endblock %}
{% block title %}Post Detail{% endblock %}

{% block app_content %}
<h2>{{ post.heading }}</h2>
<div class="minor-text">Posted on {{ moment(post.create_date).format('DD/MM/YYYY') }} by {{ post.author.firstname }} {{ post.author.lastname }}</div>
<p>{{ post.post|safe }}</p>
{% if post.getTagNames() %}
    <p><span class="minor-text">
        <span>Tags:</span>
        {% for tag_name in post.getTagNames() %}
            <a href="{{ url_for('main.index',tag=tag_name) }}">{{ tag_name }}</a>
        {% endfor %}
    </span></p>
{% endif %}
{% if current_user.is_authenticated and current_user == post.author %}
    <div class="post-btn">
        <a href="{{ url_for('post.edit_post',id=post.id) }}">edit</a>
        <a href="{{ url_for('post.del_post',id=post.id) }}">delete</a>
    </div>
{% endif %}

<hr/>
<h3>Comments</h3>
{% for comment in comments %}
    {% if comment.name is not none %}
        <p><span class="minor-text">{{ comment.name }} on {{ moment(comment.create_date).format('DD/MM/YYYY LT') }}</span></p>
    {% else %}
        {% if comment.commenter is not none %}
            <p><span class="minor-text">{{ comment.commenter.firstname }} {{ comment.commenter.lastname }}
                 on {{ moment(comment.create_date).format('DD/MM/YYYY LT') }}</span></p>
        {% endif %}
    {% endif %}
    <p>{{ comment.comment }}</p>
    <hr/>
{% endfor %}

<form action="{{ url_for('post.post_detail',id=post.id) }}" method="post">
    {{ form.csrf_token }}
    <div class="formgrid">
        {% if current_user.is_anonymous %}
            {{ form.name.label }}
            {% for error in form.name.errors %}
                <span style="color: red;">[ {{ error }} ]</span><br/>
            {% endfor %}
            {{ form.name }}

            {{ form.email.label }}
            {% for error in form.email.errors %}
                <span style="color: red;">[ {{ error }} ]</span><br/>
            {% endfor %}
            <div class="form-group">
                {{ form.email }}
                <div class="minor-text">Email is optional</div>
            </div>
        {% endif %}
        
        {{ form.comment.label }}
        {% for error in form.comment.errors %}
            <span style="color: red;">[ {{ error }} ]</span><br/>
        {% endfor %}
        {{ form.comment(rows='4') }}

        {{ form.recaptcha }}
        {% for error in form.recaptcha.errors %}
            <span style="color: red;">[ {{ error }} ]</span><br/>
        {% endfor %}

        {{ form.submit(class="submit-btn") }}
    </div>
</form>
{% endblock %}
